<!DOCTYPE html><html lang="en"><head><meta charset="utf-8">
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-VQMHVD0CS3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-VQMHVD0CS3');
</script><meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"><title>lnxadmin technical blog</title><link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16.png"><link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32.png"><link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css"><link rel="stylesheet" href="assets/css/styles.min.css"></head><body><div style="margin: 0 auto;max-width: 1200px;padding: 15px;"><nav class="navbar navbar-light navbar-expand-md py-3" style="background: var(--bs-white);"><div class="container"><a class="navbar-brand d-flex align-items-center" href="#"><span class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-tools">
  <path d="M1 0 0 1l2.2 3.081a1 1 0 0 0 .815.419h.07a1 1 0 0 1 .708.293l2.675 2.675-2.617 2.654A3.003 3.003 0 0 0 0 13a3 3 0 1 0 5.878-.851l2.654-2.617.968.968-.305.914a1 1 0 0 0 .242 1.023l3.356 3.356a1 1 0 0 0 1.414 0l1.586-1.586a1 1 0 0 0 0-1.414l-3.356-3.356a1 1 0 0 0-1.023-.242L10.5 9.5l-.96-.96 2.68-2.643A3.005 3.005 0 0 0 16 3c0-.269-.035-.53-.102-.777l-2.14 2.141L12 4l-.364-1.757L13.777.102a3 3 0 0 0-3.675 3.68L7.462 6.46 4.793 3.793a1 1 0 0 1-.293-.707v-.071a1 1 0 0 0-.419-.814L1 0zm9.646 10.646a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708zM3 11l.471.242.529.026.287.445.445.287.026.529L5 13l-.242.471-.026.529-.445.287-.287.445-.529.026L3 15l-.471-.242L2 14.732l-.287-.445L1.268 14l-.026-.529L1 13l.242-.471.026-.529.445-.287.287-.445.529-.026L3 11z"></path>
</svg></span><span>lnxadmin technical blog</span></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-1"><span class="visually-hidden">Toggle navigation</span><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navcol-1"><ul class="navbar-nav me-auto"><li class="nav-item"></li><li class="nav-item"></li><li class="nav-item"></li></ul><button class="btn btn-primary" type="button"><a href="mailto:bluescout83@googlemail.com" style="color: rgb(255,255,255);font-size: 16px;">Contact</a></button></div></div></nav><div class="row"><div class="col-10"><h2 style="margin-top: 8px;">Simple measures to secure your Ubuntu Linux servers on AWS</h2></div><div class="col"><img src="assets/img/ubuntu-logo.png" width="50px"><img src="assets/img/aws-logo.png"></div></div><p class="text-muted">Author: Niko - Last updated: 18. January 2023</p><p class="fs-5" style="margin-bottom: 32px;">I am the IT administrator in our company and must be well aware of the software patch level aswell as the accessibility of services by our developers and potential hackers, regarding our Linux servers. We run our servers on Amazon Web Services EC2, manually develop on the systems and update them according to our needs. In this small text I will show you simple ways to greatly improve the security of your Ubuntu Linux instances.</p><h4>Closing the public SSH port</h4><hr><p class="fs-5">A linux server typically must be somehow accessible for administration and this is normally through the OpenSSH service. As a general rule<strong> you should not expose the SSH port 22 to the public</strong>, internet facing side, because this a <strong>management port</strong> only to be used by either the administrator or the developers.</p><p class="fs-5">What you basically will need is configure a <strong>secure (Open)VPN connection</strong> to the <strong>private subnet</strong> where the Linux systems reside and expose the SSH port only to clients connected through VPN. This way, the clients will only be able to connect to the SSH port if they are in possession of the VPN config file that includes the clients secret private key. Speaking about AWS this can be done with the following configuration:</p><ul><li class="fs-5">A <a href="https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html" target="_blank">VPC (Virtual Private Cloud)</a> has to be created, in this VPC the <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html" target="_blank">EC2</a> linux instance(s) will be deployed. A VPC typically has an internal subnet assigned, such as for example 10.100.X.X. Into this subnet the linux instances private IP will be assigned. Be aware that a VPC can have <em>public </em>or <em>private </em>subnets, or both. A private subnet will not be connected to the internet, the instances in it can be configured to access the internet but it is not possible to access a port from the internet facing side to a specific instance in the private subnet that exposes this port (except if you create a bastion host for this purpose in the public subnet).</li><li class="fs-5">Once the VPC was created you have to put the EC2 instance into the VPC and note the private IP address.</li><li class="fs-5">The easiest way to create a secure VPN environment is to use the <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/what-is.html" target="_blank"><em>ClientVPN</em></a> service option integrated into AWS. With the ClientVPN option you have a managed VPN solution. Please read the AWS documentation about how to <a href="https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/what-is.html" target="_blank">setup ClientVPN</a>. By using ClientVPN you can use the <a href="https://openvpn.net/vpn-client/" target="_blank"><em>OpenVPN Connect</em></a> or <em>bare OpenVPN client software</em> to connect to the AWS ClientVPN service.</li></ul><p class="fs-5">Once you have set up the VPN connection you can <strong>restrict the access to the SSH port of the EC2 instance to only be accessible from the VPN connection. </strong>This is done by securing the port using the AWS&nbsp;<a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html" target="_blank"><strong>Security Groups</strong></a><strong> feature</strong>. Be aware that ClientVPN uses a NAT'ed network so you normally have to configure the source IP for the security group setting to the network (CIDR IP&nbsp;range) the ClientVPN connects to after going through NAT, this will normally be an internal network inside a VPC subnet.</p><figure class="figure" style="text-align: center;"><img class="img-fluid figure-img" src="assets/img/AWS-Security-Groups.gif"><figcaption class="figure-caption">SSH port 22 is configured for the ClientVPN NAT'ed CIDR&nbsp;IP range only, ports 80 and 443 are accessible by the public internet</figcaption></figure><h4 style="margin-top: 16px;">Disabling advertisement of service banners</h4><hr><p class="fs-5">Some services, such as SSH and Nginx expose their version number in detail. Hackers often attack a service through a vulnerability by scanning for specific service banners. In order to reduce the risk to be exposed to an unknown or unpatched vulnerability inside a service I will show you how to disable OpenSSH and Nginx version banners. For OpenSSH we already restricted access to only users that have access to the VPN client configuration file, yet a hacker, who has access to this configuration file, might enumerate the OpenSSH version in order to attack.</p><h5>OpenSSH banner</h5><p class="fs-5">An OpenSSH banner can either expose the full version, in the case of Ubuntu and Debian the SSH banner exposes also a hint to the operating system version. In order to hide the OS details in the banner you can set the option "<strong>DebianBanner no" </strong>inside the "<strong>/etc/ssh/sshd_config</strong>" file.</p><div class="alert alert-success" role="alert" style="background: var(--bs-gray-100);"><p>An example of an Ubuntu SSH service banner without having been stripped:&nbsp;<br></p><p><strong>SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7</strong><br></p><p>An example of the same Ubuntu SSH service with the banner having been stripped:</p><p><strong>SSH-2.0-OpenSSH_7.6p1</strong><br></p></div><div class="alert alert-success" role="alert" style="background: var(--bs-gray-100);"><p class="fs-6">Open the sshd config file into your favorite terminal based editor, such as nano or vi:</p><span><strong># nano /etc/ssh/sshd_config</strong></span><hr><p class="fs-6">Now enter the following line into the text editor, at the end of the sshd config file.</p><span><strong>DebianBanner no</strong></span><hr><p class="fs-6">Reload the ssh service with the following command.</p><span><strong># service ssh reload</strong></span></div><h5>Nginx banner</h5><p class="fs-5">The same applies to the Nginx HTTP service.</p><div class="alert alert-success" role="alert" style="background: var(--bs-gray-100);"><p>An example of an Nginx service banner without having been stripped:&nbsp;<br></p><p><strong>nginx/1.14.0 (Ubuntu)</strong><br></p><p>An example of the same Nginx service with the banner having been stripped:</p><p><strong>nginx</strong><br></p></div><div class="alert alert-success" role="alert" style="background: var(--bs-gray-100);"><p class="fs-6">Open the nginx config file into your favorite terminal based editor, such as nano or vi:</p><span><strong># nano /etc/nginx/nginx.conf</strong><br></span><hr><p class="fs-6">Now enter the following line into the text editor on a line by itself.</p><span><strong>server_tokens off;</strong><br></span><hr><p class="fs-6">Reload the nginx service with the following command.</p><span><strong># service nginx reload</strong></span></div><h4 style="margin-top: 32px;">Updating the Linux kernel and Ubuntu packages</h4><hr><p class="fs-5">You should keep the Linux kernel and Ubuntu packages updated. From time to time you should update these two components, regardless if a vulnerability exists in a software package or not. Especially the Linux kernel should be kept up-to-date because there are constantly released new localhost exploits that allow to escalate privileges once a hacker gained access through one of the running services or applications. The following update procedure can be helpful in cases of emergency patching of either the Linux kernel or vulnerable Ubuntu packages, aswell.</p><div class="alert alert-success" role="alert" style="background: var(--bs-gray-100);"><p>The command "<strong>uname -a</strong>" shows the Linux kernel version, including the date of compilation.<br></p><p><strong>Linux ip-10-22-0-125 5.4.0-1092-aws #100~18.04.2-Ubuntu SMP Tue Nov 29 08:39:52 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</strong><br></p><p>As can be seen from the output the Kernel was compiled on 29. November 2022, this date can be helpful to identify the date you should update your kernel. Please keep in mind that you have to reboot the instance once you have updated the kernel. It might be possible to <strong>update the Linux kernel without the need to reboot</strong>. This option is called <a href="https://ubuntu.com/security/livepatch" target="_blank"><strong>Kernel Livepatch</strong></a>&nbsp;and is available for <a href="https://ubuntu.com/pro" target="_blank">Ubuntu Pro</a> paid subscribers. Run the following commands to update your linux kernel and later on reboot to make the changes effective.</p><p></p><p><strong># apt update</strong><br></p><p><strong># apt install linux-aws</strong><br></p><p><strong># reboot</strong><br></p><p>If you want to update all packages on the linux system that have patches available, including security related patches, enter the following commands.</p><p><strong># apt update</strong><br></p><p><strong>#&nbsp;apt list --upgradable</strong><br></p><p><strong># apt upgrade</strong><br></p><p>These commands will only upgrade the currently installed ubuntu packages, the <strong>ubuntu version stays the same</strong>. If the <strong>kernel was updated</strong> and you want the new kernel to be in place, then <strong>issue the "reboot" command to restart the instance</strong>.</p></div><footer class="text-center"><div class="container text-muted py-4 py-lg-5"><ul class="list-inline"></ul><p class="mb-0">Copyright © 2023 lnxadmin.github.io contributors</p></div></footer></div><script src="assets/bootstrap/js/bootstrap.min.js"></script></body></html>